
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/View/CellView.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'fbf19Cx4ptFV62UZ7+qJJpQ', 'CellView');
// Script/View/CellView.js

"use strict";

var _ConstValue = require("../Model/ConstValue");

cc.Class({
  "extends": cc.Component,
  properties: {
    // foo: {
    //    default: null,      // The default value will be used only when the component attaching
    //                           to a node for the first time
    //    url: cc.Texture2D,  // optional, default is typeof default
    //    serializable: true, // optional, default is true
    //    visible: true,      // optional, default is true
    //    displayName: 'Foo', // optional
    //    readonly: false,    // optional, default is false
    // },
    // ...
    defaultFrame: {
      "default": null,
      type: cc.SpriteFrame
    }
  },
  // use this for initialization
  onLoad: function onLoad() {
    //this.model = null;
    this.isSelect = false;
  },
  initWithModel: function initWithModel(model) {
    this.model = model;
    var x = model.startX;
    var y = model.startY;
    this.node.x = _ConstValue.CELL_WIDTH * (x - 0.5);
    this.node.y = _ConstValue.CELL_HEIGHT * (y - 0.5);
    var animation = this.node.getComponent(cc.Animation);

    if (model.status == _ConstValue.CELL_STATUS.COMMON) {
      animation.stop();
    } else {
      animation.play(model.status);
    }
  },
  // 执行移动动作
  updateView: function updateView() {
    var _this = this;

    var cmd = this.model.cmd;

    if (cmd.length <= 0) {
      return;
    }

    var actionArray = [];
    var curTime = 0;

    for (var i in cmd) {
      if (cmd[i].playTime > curTime) {
        var delay = cc.delayTime(cmd[i].playTime - curTime);
        actionArray.push(delay);
      }

      if (cmd[i].action == "moveTo") {
        var x = (cmd[i].pos.x - 0.5) * _ConstValue.CELL_WIDTH;
        var y = (cmd[i].pos.y - 0.5) * _ConstValue.CELL_HEIGHT;
        var move = cc.moveTo(_ConstValue.ANITIME.TOUCH_MOVE, cc.v2(x, y));
        actionArray.push(move);
      } else if (cmd[i].action == "toDie") {
        if (this.status == _ConstValue.CELL_STATUS.BIRD) {
          var animation = this.node.getComponent(cc.Animation);
          animation.play("effect");
          actionArray.push(cc.delayTime(_ConstValue.ANITIME.BOMB_BIRD_DELAY));
        }

        var callFunc = cc.callFunc(function () {
          this.node.destroy();
        }, this);
        actionArray.push(callFunc);
      } else if (cmd[i].action == "setVisible") {
        (function () {
          var isVisible = cmd[i].isVisible;
          actionArray.push(cc.callFunc(function () {
            if (isVisible) {
              this.node.opacity = 255;
            } else {
              this.node.opacity = 0;
            }
          }, _this));
        })();
      } else if (cmd[i].action == "toShake") {
        var rotateRight = cc.rotateBy(0.06, 30);
        var rotateLeft = cc.rotateBy(0.12, -60);
        actionArray.push(cc.repeat(cc.sequence(rotateRight, rotateLeft, rotateRight), 2));
      }

      curTime = cmd[i].playTime + cmd[i].keepTime;
    }
    /**
     * 智障的引擎设计，一群SB
     */


    if (actionArray.length == 1) {
      this.node.runAction(actionArray[0]);
    } else {
      var _cc;

      this.node.runAction((_cc = cc).sequence.apply(_cc, actionArray));
    }
  },
  // called every frame, uncomment this function to activate update callback
  // update: function (dt) {
  // },
  setSelect: function setSelect(flag) {
    var animation = this.node.getComponent(cc.Animation);
    var bg = this.node.getChildByName("select");

    if (flag == false && this.isSelect && this.model.status == _ConstValue.CELL_STATUS.COMMON) {
      animation.stop();
      this.node.getComponent(cc.Sprite).spriteFrame = this.defaultFrame;
    } else if (flag && this.model.status == _ConstValue.CELL_STATUS.COMMON) {
      animation.play(_ConstValue.CELL_STATUS.CLICK);
    } else if (flag && this.model.status == _ConstValue.CELL_STATUS.BIRD) {
      animation.play(_ConstValue.CELL_STATUS.CLICK);
    }

    bg.active = flag;
    this.isSelect = flag;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvVmlldy9DZWxsVmlldy5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImRlZmF1bHRGcmFtZSIsInR5cGUiLCJTcHJpdGVGcmFtZSIsIm9uTG9hZCIsImlzU2VsZWN0IiwiaW5pdFdpdGhNb2RlbCIsIm1vZGVsIiwieCIsInN0YXJ0WCIsInkiLCJzdGFydFkiLCJub2RlIiwiQ0VMTF9XSURUSCIsIkNFTExfSEVJR0hUIiwiYW5pbWF0aW9uIiwiZ2V0Q29tcG9uZW50IiwiQW5pbWF0aW9uIiwic3RhdHVzIiwiQ0VMTF9TVEFUVVMiLCJDT01NT04iLCJzdG9wIiwicGxheSIsInVwZGF0ZVZpZXciLCJjbWQiLCJsZW5ndGgiLCJhY3Rpb25BcnJheSIsImN1clRpbWUiLCJpIiwicGxheVRpbWUiLCJkZWxheSIsImRlbGF5VGltZSIsInB1c2giLCJhY3Rpb24iLCJwb3MiLCJtb3ZlIiwibW92ZVRvIiwiQU5JVElNRSIsIlRPVUNIX01PVkUiLCJ2MiIsIkJJUkQiLCJCT01CX0JJUkRfREVMQVkiLCJjYWxsRnVuYyIsImRlc3Ryb3kiLCJpc1Zpc2libGUiLCJvcGFjaXR5Iiwicm90YXRlUmlnaHQiLCJyb3RhdGVCeSIsInJvdGF0ZUxlZnQiLCJyZXBlYXQiLCJzZXF1ZW5jZSIsImtlZXBUaW1lIiwicnVuQWN0aW9uIiwic2V0U2VsZWN0IiwiZmxhZyIsImJnIiwiZ2V0Q2hpbGRCeU5hbWUiLCJTcHJpdGUiLCJzcHJpdGVGcmFtZSIsIkNMSUNLIiwiYWN0aXZlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUU7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBQyxJQUFBQSxZQUFZLEVBQUM7QUFD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QUFXVyxNQUFYLElBQXFCQyx3QkFBWXFCLElBQTVDLEVBQWlEO0FBQ2xEekIsTUFBQUEsU0FBUyxDQUFDTyxJQUFWLENBQWVILHdCQUFZd0MsS0FBM0I7QUFDSDs7QUFDREosSUFBQUEsRUFBRSxDQUFDSyxNQUFILEdBQVlOLElBQVo7QUFDQSxTQUFLakQsUUFBTCxHQUFnQmlELElBQWhCO0FBQ0g7QUFySEksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDRUxMX1NUQVRVUywgQ0VMTF9XSURUSCwgQ0VMTF9IRUlHSFQsIEFOSVRJTUV9IGZyb20gJy4uL01vZGVsL0NvbnN0VmFsdWUnO1xuXG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICAvLyBmb286IHtcbiAgICAgICAgLy8gICAgZGVmYXVsdDogbnVsbCwgICAgICAvLyBUaGUgZGVmYXVsdCB2YWx1ZSB3aWxsIGJlIHVzZWQgb25seSB3aGVuIHRoZSBjb21wb25lbnQgYXR0YWNoaW5nXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gYSBub2RlIGZvciB0aGUgZmlyc3QgdGltZVxuICAgICAgICAvLyAgICB1cmw6IGNjLlRleHR1cmUyRCwgIC8vIG9wdGlvbmFsLCBkZWZhdWx0IGlzIHR5cGVvZiBkZWZhdWx0XG4gICAgICAgIC8vICAgIHNlcmlhbGl6YWJsZTogdHJ1ZSwgLy8gb3B0aW9uYWwsIGRlZmF1bHQgaXMgdHJ1ZVxuICAgICAgICAvLyAgICB2aXNpYmxlOiB0cnVlLCAgICAgIC8vIG9wdGlvbmFsLCBkZWZhdWx0IGlzIHRydWVcbiAgICAgICAgLy8gICAgZGlzcGxheU5hbWU6ICdGb28nLCAvLyBvcHRpb25hbFxuICAgICAgICAvLyAgICByZWFkb25seTogZmFsc2UsICAgIC8vIG9wdGlvbmFsLCBkZWZhdWx0IGlzIGZhbHNlXG4gICAgICAgIC8vIH0sXG4gICAgICAgIC8vIC4uLlxuICAgICAgICBkZWZhdWx0RnJhbWU6e1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLlNwcml0ZUZyYW1lXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gdXNlIHRoaXMgZm9yIGluaXRpYWxpemF0aW9uXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vdGhpcy5tb2RlbCA9IG51bGw7XG4gICAgICAgIHRoaXMuaXNTZWxlY3QgPSBmYWxzZTtcbiAgICB9LFxuICAgIGluaXRXaXRoTW9kZWw6IGZ1bmN0aW9uKG1vZGVsKXtcbiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgICAgICB2YXIgeCA9IG1vZGVsLnN0YXJ0WDtcbiAgICAgICAgdmFyIHkgPSBtb2RlbC5zdGFydFk7XG4gICAgICAgIHRoaXMubm9kZS54ID0gQ0VMTF9XSURUSCAqICh4IC0gMC41KTtcbiAgICAgICAgdGhpcy5ub2RlLnkgPSBDRUxMX0hFSUdIVCAqICh5IC0gMC41KTtcbiAgICAgICAgdmFyIGFuaW1hdGlvbiAgPSB0aGlzLm5vZGUuZ2V0Q29tcG9uZW50KGNjLkFuaW1hdGlvbik7XG4gICAgICAgIGlmIChtb2RlbC5zdGF0dXMgPT0gQ0VMTF9TVEFUVVMuQ09NTU9OKXtcbiAgICAgICAgICAgIGFuaW1hdGlvbi5zdG9wKCk7XG4gICAgICAgIH0gXG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICBhbmltYXRpb24ucGxheShtb2RlbC5zdGF0dXMpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAvLyDmiafooYznp7vliqjliqjkvZxcbiAgICB1cGRhdGVWaWV3OiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgY21kID0gdGhpcy5tb2RlbC5jbWQ7XG4gICAgICAgIGlmKGNtZC5sZW5ndGggPD0gMCl7XG4gICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhY3Rpb25BcnJheSA9IFtdO1xuICAgICAgICB2YXIgY3VyVGltZSA9IDA7XG4gICAgICAgIGZvcih2YXIgaSBpbiBjbWQpe1xuICAgICAgICAgICAgaWYoIGNtZFtpXS5wbGF5VGltZSA+IGN1clRpbWUpe1xuICAgICAgICAgICAgICAgIHZhciBkZWxheSA9IGNjLmRlbGF5VGltZShjbWRbaV0ucGxheVRpbWUgLSBjdXJUaW1lKTtcbiAgICAgICAgICAgICAgICBhY3Rpb25BcnJheS5wdXNoKGRlbGF5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGNtZFtpXS5hY3Rpb24gPT0gXCJtb3ZlVG9cIil7XG4gICAgICAgICAgICAgICAgdmFyIHggPSAoY21kW2ldLnBvcy54IC0gMC41KSAqIENFTExfV0lEVEg7XG4gICAgICAgICAgICAgICAgdmFyIHkgPSAoY21kW2ldLnBvcy55IC0gMC41KSAqIENFTExfSEVJR0hUO1xuICAgICAgICAgICAgICAgIHZhciBtb3ZlID0gY2MubW92ZVRvKEFOSVRJTUUuVE9VQ0hfTU9WRSwgY2MudjIoeCx5KSk7XG4gICAgICAgICAgICAgICAgYWN0aW9uQXJyYXkucHVzaChtb3ZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoY21kW2ldLmFjdGlvbiA9PSBcInRvRGllXCIpe1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc3RhdHVzID09IENFTExfU1RBVFVTLkJJUkQpe1xuICAgICAgICAgICAgICAgICAgICBsZXQgYW5pbWF0aW9uID0gdGhpcy5ub2RlLmdldENvbXBvbmVudChjYy5BbmltYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb24ucGxheShcImVmZmVjdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uQXJyYXkucHVzaChjYy5kZWxheVRpbWUoQU5JVElNRS5CT01CX0JJUkRfREVMQVkpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGNhbGxGdW5jID0gY2MuY2FsbEZ1bmMoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub2RlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICB9LHRoaXMpO1xuICAgICAgICAgICAgICAgIGFjdGlvbkFycmF5LnB1c2goY2FsbEZ1bmMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihjbWRbaV0uYWN0aW9uID09IFwic2V0VmlzaWJsZVwiKXtcbiAgICAgICAgICAgICAgICBsZXQgaXNWaXNpYmxlID0gY21kW2ldLmlzVmlzaWJsZTtcbiAgICAgICAgICAgICAgICBhY3Rpb25BcnJheS5wdXNoKGNjLmNhbGxGdW5jKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGlmKGlzVmlzaWJsZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5vZGUub3BhY2l0eSA9IDI1NTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ub2RlLm9wYWNpdHkgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSx0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGNtZFtpXS5hY3Rpb24gPT0gXCJ0b1NoYWtlXCIpe1xuICAgICAgICAgICAgICAgIGxldCByb3RhdGVSaWdodCA9IGNjLnJvdGF0ZUJ5KDAuMDYsMzApO1xuICAgICAgICAgICAgICAgIGxldCByb3RhdGVMZWZ0ID0gY2Mucm90YXRlQnkoMC4xMiwgLTYwKTtcbiAgICAgICAgICAgICAgICBhY3Rpb25BcnJheS5wdXNoKGNjLnJlcGVhdChjYy5zZXF1ZW5jZShyb3RhdGVSaWdodCwgcm90YXRlTGVmdCwgcm90YXRlUmlnaHQpLCAyKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJUaW1lID0gY21kW2ldLnBsYXlUaW1lICsgY21kW2ldLmtlZXBUaW1lO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDmmbrpmpznmoTlvJXmk47orr7orqHvvIzkuIDnvqRTQlxuICAgICAgICAgKi9cbiAgICAgICAgaWYoYWN0aW9uQXJyYXkubGVuZ3RoID09IDEpe1xuICAgICAgICAgICAgdGhpcy5ub2RlLnJ1bkFjdGlvbihhY3Rpb25BcnJheVswXSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZXtcbiAgICAgICAgICAgIHRoaXMubm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoLi4uYWN0aW9uQXJyYXkpKTtcbiAgICAgICAgfVxuXG4gICAgfSxcbiAgICAvLyBjYWxsZWQgZXZlcnkgZnJhbWUsIHVuY29tbWVudCB0aGlzIGZ1bmN0aW9uIHRvIGFjdGl2YXRlIHVwZGF0ZSBjYWxsYmFja1xuICAgIC8vIHVwZGF0ZTogZnVuY3Rpb24gKGR0KSB7XG5cbiAgICAvLyB9LFxuICAgIHNldFNlbGVjdDogZnVuY3Rpb24oZmxhZyl7XG4gICAgICAgIHZhciBhbmltYXRpb24gPSB0aGlzLm5vZGUuZ2V0Q29tcG9uZW50KGNjLkFuaW1hdGlvbik7XG4gICAgICAgIHZhciBiZyA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcInNlbGVjdFwiKTtcbiAgICAgICAgaWYoZmxhZyA9PSBmYWxzZSAmJiB0aGlzLmlzU2VsZWN0ICYmIHRoaXMubW9kZWwuc3RhdHVzID09IENFTExfU1RBVFVTLkNPTU1PTil7XG4gICAgICAgICAgICBhbmltYXRpb24uc3RvcCgpO1xuICAgICAgICAgICAgdGhpcy5ub2RlLmdldENvbXBvbmVudChjYy5TcHJpdGUpLnNwcml0ZUZyYW1lID0gdGhpcy5kZWZhdWx0RnJhbWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZihmbGFnICYmIHRoaXMubW9kZWwuc3RhdHVzID09IENFTExfU1RBVFVTLkNPTU1PTil7XG4gICAgICAgICAgICBhbmltYXRpb24ucGxheShDRUxMX1NUQVRVUy5DTElDSyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZihmbGFnICYmIHRoaXMubW9kZWwuc3RhdHVzID09IENFTExfU1RBVFVTLkJJUkQpe1xuICAgICAgICAgICAgYW5pbWF0aW9uLnBsYXkoQ0VMTF9TVEFUVVMuQ0xJQ0spO1xuICAgICAgICB9XG4gICAgICAgIGJnLmFjdGl2ZSA9IGZsYWc7IFxuICAgICAgICB0aGlzLmlzU2VsZWN0ID0gZmxhZztcbiAgICB9XG59KTtcbiJdfQ==