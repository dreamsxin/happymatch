
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/View/GridView.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'd0d1fDj9rlDx5QUtP+2toQV', 'GridView');
// Script/View/GridView.js

"use strict";

var _ConstValue = require("../Model/ConstValue");

var _AudioUtils = _interopRequireDefault(require("../Utils/AudioUtils"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

cc.Class({
  "extends": cc.Component,
  properties: {
    // foo: {
    //    default: null,      // The default value will be used only when the component attaching
    //                           to a node for the first time
    //    url: cc.Texture2D,  // optional, default is typeof default
    //    serializable: true, // optional, default is true
    //    visible: true,      // optional, default is true
    //    displayName: 'Foo', // optional
    //    readonly: false,    // optional, default is false
    // },
    // ...
    aniPre: {
      "default": [],
      type: [cc.Prefab]
    },
    effectLayer: {
      "default": null,
      type: cc.Node
    },
    audioUtils: {
      type: _AudioUtils["default"],
      "default": null
    }
  },
  // use this for initialization
  onLoad: function onLoad() {
    this.setListener();
    this.lastTouchPos = cc.Vec2(-1, -1);
    this.isCanMove = true;
    this.isInPlayAni = false; // 是否在播放中
  },
  setController: function setController(controller) {
    this.controller = controller;
  },
  initWithCellModels: function initWithCellModels(cellsModels) {
    this.cellViews = [];

    for (var i = 1; i <= 9; i++) {
      this.cellViews[i] = [];

      for (var j = 1; j <= 9; j++) {
        var type = cellsModels[i][j].type;
        var aniView = cc.instantiate(this.aniPre[type]);
        aniView.parent = this.node;
        var cellViewScript = aniView.getComponent("CellView");
        cellViewScript.initWithModel(cellsModels[i][j]);
        this.cellViews[i][j] = aniView;
      }
    }
  },
  setListener: function setListener() {
    this.node.on(cc.Node.EventType.TOUCH_START, function (eventTouch) {
      if (this.isInPlayAni) {
        //播放动画中，不允许点击
        return true;
      }

      var touchPos = eventTouch.getLocation();
      var cellPos = this.convertTouchPosToCell(touchPos);

      if (cellPos) {
        var changeModels = this.selectCell(cellPos);
        this.isCanMove = changeModels.length < 3;
      } else {
        this.isCanMove = false;
      }

      return true;
    }, this); // 滑动操作逻辑

    this.node.on(cc.Node.EventType.TOUCH_MOVE, function (eventTouch) {
      if (this.isCanMove) {
        var startTouchPos = eventTouch.getStartLocation();
        var startCellPos = this.convertTouchPosToCell(startTouchPos);
        var touchPos = eventTouch.getLocation();
        var cellPos = this.convertTouchPosToCell(touchPos);

        if (startCellPos.x != cellPos.x || startCellPos.y != cellPos.y) {
          this.isCanMove = false;
          var changeModels = this.selectCell(cellPos);
        }
      }
    }, this);
    this.node.on(cc.Node.EventType.TOUCH_END, function (eventTouch) {// console.log("1111");
    }, this);
    this.node.on(cc.Node.EventType.TOUCH_CANCEL, function (eventTouch) {// console.log("1111");
    }, this);
  },
  // 根据点击的像素位置，转换成网格中的位置
  convertTouchPosToCell: function convertTouchPosToCell(pos) {
    pos = this.node.convertToNodeSpace(pos);

    if (pos.x < 0 || pos.x >= _ConstValue.GRID_PIXEL_WIDTH || pos.y < 0 || pos.y >= _ConstValue.GRID_PIXEL_HEIGHT) {
      return false;
    }

    var x = Math.floor(pos.x / _ConstValue.CELL_WIDTH) + 1;
    var y = Math.floor(pos.y / _ConstValue.CELL_HEIGHT) + 1;
    return cc.v2(x, y);
  },
  // 移动格子
  updateView: function updateView(changeModels) {
    var newCellViewInfo = [];

    for (var i in changeModels) {
      var model = changeModels[i];
      var viewInfo = this.findViewByModel(model);
      var view = null; // 如果原来的cell不存在，则新建

      if (!viewInfo) {
        var type = model.type;
        var aniView = cc.instantiate(this.aniPre[type]);
        aniView.parent = this.node;
        var cellViewScript = aniView.getComponent("CellView");
        cellViewScript.initWithModel(model);
        view = aniView;
      } // 如果已经存在
      else {
          view = viewInfo.view;
          this.cellViews[viewInfo.y][viewInfo.x] = null;
        }

      var cellScript = view.getComponent("CellView");
      cellScript.updateView(); // 执行移动动作

      if (!model.isDeath) {
        newCellViewInfo.push({
          model: model,
          view: view
        });
      }
    } // 重新标记this.cellviews的信息


    newCellViewInfo.forEach(function (ele) {
      var model = ele.model;
      this.cellViews[model.y][model.x] = ele.view;
    }, this);
  },
  // 显示选中的格子背景
  updateSelect: function updateSelect(pos) {
    for (var i = 1; i <= 9; i++) {
      for (var j = 1; j <= 9; j++) {
        if (this.cellViews[i][j]) {
          var cellScript = this.cellViews[i][j].getComponent("CellView");

          if (pos.x == j && pos.y == i) {
            cellScript.setSelect(true);
          } else {
            cellScript.setSelect(false);
          }
        }
      }
    }
  },

  /**
   * 根据cell的model返回对应的view
   */
  findViewByModel: function findViewByModel(model) {
    for (var i = 1; i <= 9; i++) {
      for (var j = 1; j <= 9; j++) {
        if (this.cellViews[i][j] && this.cellViews[i][j].getComponent("CellView").model == model) {
          return {
            view: this.cellViews[i][j],
            x: j,
            y: i
          };
        }
      }
    }

    return null;
  },
  getPlayAniTime: function getPlayAniTime(changeModels) {
    if (!changeModels) {
      return 0;
    }

    var maxTime = 0;
    changeModels.forEach(function (ele) {
      ele.cmd.forEach(function (cmd) {
        if (maxTime < cmd.playTime + cmd.keepTime) {
          maxTime = cmd.playTime + cmd.keepTime;
        }
      }, this);
    }, this);
    return maxTime;
  },
  // 获得爆炸次数， 同一个时间算一个
  getStep: function getStep(effectsQueue) {
    if (!effectsQueue) {
      return 0;
    }

    return effectsQueue.reduce(function (maxValue, efffectCmd) {
      return Math.max(maxValue, efffectCmd.step || 0);
    }, 0);
  },
  //一段时间内禁止操作
  disableTouch: function disableTouch(time, step) {
    if (time <= 0) {
      return;
    }

    this.isInPlayAni = true;
    this.node.runAction(cc.sequence(cc.delayTime(time), cc.callFunc(function () {
      this.isInPlayAni = false;
      this.audioUtils.playContinuousMatch(step);
    }, this)));
  },
  // 正常击中格子后的操作
  selectCell: function selectCell(cellPos) {
    var result = this.controller.selectCell(cellPos); // 直接先丢给model处理数据逻辑

    var changeModels = result[0]; // 有改变的cell，包含新生成的cell和生成马上摧毁的格子

    var effectsQueue = result[1]; //各种特效

    this.playEffect(effectsQueue);
    this.disableTouch(this.getPlayAniTime(changeModels), this.getStep(effectsQueue));
    this.updateView(changeModels);
    this.controller.cleanCmd();

    if (changeModels.length >= 2) {
      this.updateSelect(cc.v2(-1, -1));
      this.audioUtils.playSwap();
    } else {
      this.updateSelect(cellPos);
      this.audioUtils.playClick();
    }

    return changeModels;
  },
  playEffect: function playEffect(effectsQueue) {
    this.effectLayer.getComponent("EffectLayer").playEffects(effectsQueue);
  } // called every frame, uncomment this function to activate update callback
  // update: function (dt) {
  // },

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvVmlldy9HcmlkVmlldy5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImFuaVByZSIsInR5cGUiLCJQcmVmYWIiLCJlZmZlY3RMYXllciIsIk5vZGUiLCJhdWRpb1V0aWxzIiwiQXVkaW9VdGlscyIsIm9uTG9hZCIsInNldExpc3RlbmVyIiwibGFzdFRvdWNoUG9zIiwiVmVjMiIsImlzQ2FuTW92ZSIsImlzSW5QbGF5QW5pIiwic2V0Q29udHJvbGxlciIsImNvbnRyb2xsZXIiLCJpbml0V2l0aENlbGxNb2RlbHMiLCJjZWxsc01vZGVscyIsImNlbGxWaWV3cyIsImkiLCJqIiwiYW5pVmlldyIsImluc3RhbnRpYXRlIiwicGFyZW50Iiwibm9kZSIsImNlbGxWaWV3U2NyaXB0IiwiZ2V0Q29tcG9uZW50IiwiaW5pdFdpdGhNb2RlbCIsIm9uIiwiRXZlbnRUeXBlIiwiVE9VQ0hfU1RBUlQiLCJldmVudFRvdWNoIiwidG91Y2hQb3MiLCJnZXRMb2NhdGlvbiIsImNlbGxQb3MiLCJjb252ZXJ0VG91Y2hQb3NUb0NlbGwiLCJjaGFuZ2VNb2RlbHMiLCJzZWxlY3RDZWxsIiwibGVuZ3RoIiwiVE9VQ0hfTU9WRSIsInN0YXJ0VG91Y2hQb3MiLCJnZXRTdGFydExvY2F0aW9uIiwic3RhcnRDZWxsUG9zIiwieCIsInkiLCJUT1VDSF9FTkQiLCJUT1VDSF9DQU5DRUwiLCJwb3MiLCJjb252ZXJ0VG9Ob2RlU3BhY2UiLCJHUklEX1BJWEVMX1dJRFRIIiwiR1JJRF9QSVhFTF9IRUlHSFQiLCJNYXRoIiwiZmxvb3IiLCJDRUxMX1dJRFRIIiwiQ0VMTF9IRUlHSFQiLCJ2MiIsInVwZGF0ZVZpZXciLCJuZXdDZWxsVmlld0luZm8iLCJtb2RlbCIsInZpZXdJbmZvIiwiZmluZFZpZXdCeU1vZGVsIiwidmlldyIsImNlbGxTY3JpcHQiLCJpc0RlYXRoIiwicHVzaCIsImZvckVhY2giLCJlbGUiLCJ1cGRhdGVTZWxlY3QiLCJzZXRTZWxlY3QiLCJnZXRQbGF5QW5pVGltZSIsIm1heFRpbWUiLCJjbWQiLCJwbGF5VGltZSIsImtlZXBUaW1lIiwiZ2V0U3RlcCIsImVmZmVjdHNRdWV1ZSIsInJlZHVjZSIsIm1heFZhbHVlIiwiZWZmZmVjdENtZCIsIm1heCIsInN0ZXAiLCJkaXNhYmxlVG91Y2giLCJ0aW1lIiwicnVuQWN0aW9uIiwic2VxdWVuY2UiLCJkZWxheVRpbWUiLCJjYWxsRnVuYyIsInBsYXlDb250aW51b3VzTWF0Y2giLCJyZXN1bHQiLCJwbGF5RWZmZWN0IiwiY2xlYW5DbWQiLCJwbGF5U3dhcCIsInBsYXlDbGljayIsInBsYXlFZmZlY3RzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOzs7O0FBRUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FDLElBQUFBLE1BQU0sRUFBRTtBQUNKLGlCQUFTLEVBREw7QUFFSkMsTUFBQUEsSUFBSSxFQUFFLENBQUNMLEVBQUUsQ0FBQ00sTUFBSjtBQUZGLEtBWEE7QUFlUkMsSUFBQUEsV0FBVyxFQUFFO0FBQ1QsaUJBQVMsSUFEQTtBQUVURixNQUFBQSxJQUFJLEVBQUVMLEVBQUUsQ0FBQ1E7QUFGQSxLQWZMO0FBbUJSQyxJQUFBQSxVQUFVLEVBQUM7QUFDUEosTUFBQUEsSUFBSSxFQUFFSyxzQkFEQztBQUVQLGlCQUFTO0FBRkY7QUFuQkgsR0FIUDtBQThCTDtBQUNBQyxFQUFBQSxNQUFNLEVBQUUsa0JBQVk7QUFDaEIsU0FBS0MsV0FBTDtBQUNBLFNBQUtDLFlBQUwsR0FBb0JiLEVBQUUsQ0FBQ2MsSUFBSCxDQUFRLENBQUMsQ0FBVCxFQUFZLENBQUMsQ0FBYixDQUFwQjtBQUNBLFNBQUtDLFNBQUwsR0FBaUIsSUFBakI7QUFDQSxTQUFLQyxXQUFMLEdB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QmpDLFlBQXBCLENBQWxCLEVBQXFELEtBQUtzQyxPQUFMLENBQWFDLFlBQWIsQ0FBckQ7QUFDQSxTQUFLbkIsVUFBTCxDQUFnQnBCLFlBQWhCO0FBQ0EsU0FBS3JCLFVBQUwsQ0FBZ0IyRSxRQUFoQjs7QUFDQSxRQUFHdEQsWUFBWSxDQUFDRSxNQUFiLElBQXVCLENBQTFCLEVBQTRCO0FBQ3hCLFdBQUs2QixZQUFMLENBQWtCdEUsRUFBRSxDQUFDMEQsRUFBSCxDQUFNLENBQUMsQ0FBUCxFQUFTLENBQUMsQ0FBVixDQUFsQjtBQUNBLFdBQUtqRCxVQUFMLENBQWdCcUYsUUFBaEI7QUFDSCxLQUhELE1BSUk7QUFDQSxXQUFLeEIsWUFBTCxDQUFrQmpDLE9BQWxCO0FBQ0EsV0FBSzVCLFVBQUwsQ0FBZ0JzRixTQUFoQjtBQUNIOztBQUNELFdBQU94RCxZQUFQO0FBQ0gsR0E1Tkk7QUE2TkxxRCxFQUFBQSxVQUFVLEVBQUUsb0JBQVNkLFlBQVQsRUFBc0I7QUFDOUIsU0FBS3ZFLFdBQUwsQ0FBaUJzQixZQUFqQixDQUE4QixhQUE5QixFQUE2Q21FLFdBQTdDLENBQXlEbEIsWUFBekQ7QUFDSCxHQS9OSSxDQW9PTDtBQUNBO0FBRUE7O0FBdk9LLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q0VMTF9XSURUSCwgQ0VMTF9IRUlHSFQsIEdSSURfUElYRUxfV0lEVEgsIEdSSURfUElYRUxfSEVJR0hULCBBTklUSU1FfSBmcm9tICcuLi9Nb2RlbC9Db25zdFZhbHVlJztcblxuaW1wb3J0IEF1ZGlvVXRpbHMgZnJvbSBcIi4uL1V0aWxzL0F1ZGlvVXRpbHNcIjtcblxuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgLy8gZm9vOiB7XG4gICAgICAgIC8vICAgIGRlZmF1bHQ6IG51bGwsICAgICAgLy8gVGhlIGRlZmF1bHQgdmFsdWUgd2lsbCBiZSB1c2VkIG9ubHkgd2hlbiB0aGUgY29tcG9uZW50IGF0dGFjaGluZ1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIGEgbm9kZSBmb3IgdGhlIGZpcnN0IHRpbWVcbiAgICAgICAgLy8gICAgdXJsOiBjYy5UZXh0dXJlMkQsICAvLyBvcHRpb25hbCwgZGVmYXVsdCBpcyB0eXBlb2YgZGVmYXVsdFxuICAgICAgICAvLyAgICBzZXJpYWxpemFibGU6IHRydWUsIC8vIG9wdGlvbmFsLCBkZWZhdWx0IGlzIHRydWVcbiAgICAgICAgLy8gICAgdmlzaWJsZTogdHJ1ZSwgICAgICAvLyBvcHRpb25hbCwgZGVmYXVsdCBpcyB0cnVlXG4gICAgICAgIC8vICAgIGRpc3BsYXlOYW1lOiAnRm9vJywgLy8gb3B0aW9uYWxcbiAgICAgICAgLy8gICAgcmVhZG9ubHk6IGZhbHNlLCAgICAvLyBvcHRpb25hbCwgZGVmYXVsdCBpcyBmYWxzZVxuICAgICAgICAvLyB9LFxuICAgICAgICAvLyAuLi5cbiAgICAgICAgYW5pUHJlOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBbXSxcbiAgICAgICAgICAgIHR5cGU6IFtjYy5QcmVmYWJdXG4gICAgICAgIH0sXG4gICAgICAgIGVmZmVjdExheWVyOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuTm9kZVxuICAgICAgICB9LFxuICAgICAgICBhdWRpb1V0aWxzOntcbiAgICAgICAgICAgIHR5cGU6IEF1ZGlvVXRpbHMsXG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfSxcblxuXG4gICAgLy8gdXNlIHRoaXMgZm9yIGluaXRpYWxpemF0aW9uXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc2V0TGlzdGVuZXIoKTtcbiAgICAgICAgdGhpcy5sYXN0VG91Y2hQb3MgPSBjYy5WZWMyKC0xLCAtMSk7XG4gICAgICAgIHRoaXMuaXNDYW5Nb3ZlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pc0luUGxheUFuaSA9IGZhbHNlOyAvLyDmmK/lkKblnKjmkq3mlL7kuK1cbiAgICB9LFxuICAgIHNldENvbnRyb2xsZXI6IGZ1bmN0aW9uKGNvbnRyb2xsZXIpe1xuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBjb250cm9sbGVyO1xuICAgIH0sXG5cbiAgICBpbml0V2l0aENlbGxNb2RlbHM6IGZ1bmN0aW9uKGNlbGxzTW9kZWxzKXtcbiAgICAgICAgdGhpcy5jZWxsVmlld3MgPSBbXTtcbiAgICAgICAgZm9yKHZhciBpID0gMTtpPD05O2krKyl7XG4gICAgICAgICAgICB0aGlzLmNlbGxWaWV3c1tpXSA9IFtdO1xuICAgICAgICAgICAgZm9yKHZhciBqID0gMTtqPD05O2orKyl7XG4gICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBjZWxsc01vZGVsc1tpXVtqXS50eXBlO1xuICAgICAgICAgICAgICAgIHZhciBhbmlWaWV3ID0gY2MuaW5zdGFudGlhdGUodGhpcy5hbmlQcmVbdHlwZV0pO1xuICAgICAgICAgICAgICAgIGFuaVZpZXcucGFyZW50ID0gdGhpcy5ub2RlO1xuICAgICAgICAgICAgICAgIHZhciBjZWxsVmlld1NjcmlwdCA9IGFuaVZpZXcuZ2V0Q29tcG9uZW50KFwiQ2VsbFZpZXdcIik7XG4gICAgICAgICAgICAgICAgY2VsbFZpZXdTY3JpcHQuaW5pdFdpdGhNb2RlbChjZWxsc01vZGVsc1tpXVtqXSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jZWxsVmlld3NbaV1bal0gPSBhbmlWaWV3O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbiAgICBzZXRMaXN0ZW5lcjogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX1NUQVJULCBmdW5jdGlvbihldmVudFRvdWNoKXtcbiAgICAgICAgICAgIGlmKHRoaXMuaXNJblBsYXlBbmkpey8v5pKt5pS+5Yqo55S75Lit77yM5LiN5YWB6K6454K55Ye7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdG91Y2hQb3MgPSBldmVudFRvdWNoLmdldExvY2F0aW9uKCk7XG4gICAgICAgICAgICB2YXIgY2VsbFBvcyA9IHRoaXMuY29udmVydFRvdWNoUG9zVG9DZWxsKHRvdWNoUG9zKTtcbiAgICAgICAgICAgIGlmKGNlbGxQb3Mpe1xuICAgICAgICAgICAgICAgIHZhciBjaGFuZ2VNb2RlbHMgPSB0aGlzLnNlbGVjdENlbGwoY2VsbFBvcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0Nhbk1vdmUgPSBjaGFuZ2VNb2RlbHMubGVuZ3RoIDwgMztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0Nhbk1vdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAvLyDmu5Hliqjmk43kvZzpgLvovpFcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUsIGZ1bmN0aW9uKGV2ZW50VG91Y2gpe1xuICAgICAgICAgICBpZih0aGlzLmlzQ2FuTW92ZSl7XG4gICAgICAgICAgICAgICB2YXIgc3RhcnRUb3VjaFBvcyA9IGV2ZW50VG91Y2guZ2V0U3RhcnRMb2NhdGlvbiAoKTtcbiAgICAgICAgICAgICAgIHZhciBzdGFydENlbGxQb3MgPSB0aGlzLmNvbnZlcnRUb3VjaFBvc1RvQ2VsbChzdGFydFRvdWNoUG9zKTtcbiAgICAgICAgICAgICAgIHZhciB0b3VjaFBvcyA9IGV2ZW50VG91Y2guZ2V0TG9jYXRpb24oKTtcbiAgICAgICAgICAgICAgIHZhciBjZWxsUG9zID0gdGhpcy5jb252ZXJ0VG91Y2hQb3NUb0NlbGwodG91Y2hQb3MpO1xuICAgICAgICAgICAgICAgaWYoc3RhcnRDZWxsUG9zLnggIT0gY2VsbFBvcy54IHx8IHN0YXJ0Q2VsbFBvcy55ICE9IGNlbGxQb3MueSl7XG4gICAgICAgICAgICAgICAgICAgdGhpcy5pc0Nhbk1vdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICB2YXIgY2hhbmdlTW9kZWxzID0gdGhpcy5zZWxlY3RDZWxsKGNlbGxQb3MpOyBcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0VORCwgZnVuY3Rpb24oZXZlbnRUb3VjaCl7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCIxMTExXCIpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0NBTkNFTCwgZnVuY3Rpb24oZXZlbnRUb3VjaCl7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCIxMTExXCIpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9LFxuICAgIC8vIOagueaNrueCueWHu+eahOWDj+e0oOS9jee9ru+8jOi9rOaNouaIkOe9keagvOS4reeahOS9jee9rlxuICAgIGNvbnZlcnRUb3VjaFBvc1RvQ2VsbDogZnVuY3Rpb24ocG9zKXtcbiAgICAgICAgcG9zID0gdGhpcy5ub2RlLmNvbnZlcnRUb05vZGVTcGFjZShwb3MpO1xuICAgICAgICBpZihwb3MueCA8IDAgfHwgcG9zLnggPj0gR1JJRF9QSVhFTF9XSURUSCB8fCBwb3MueSA8IDAgfHwgcG9zLnkgPj0gR1JJRF9QSVhFTF9IRUlHSFQpe1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihwb3MueCAvIENFTExfV0lEVEgpICsgMTtcbiAgICAgICAgdmFyIHkgPSBNYXRoLmZsb29yKHBvcy55IC8gQ0VMTF9IRUlHSFQpICsgMTtcbiAgICAgICAgcmV0dXJuIGNjLnYyKHgsIHkpO1xuICAgIH0sXG4gICAgLy8g56e75Yqo5qC85a2QXG4gICAgdXBkYXRlVmlldzogZnVuY3Rpb24oY2hhbmdlTW9kZWxzKXtcbiAgICAgICAgbGV0IG5ld0NlbGxWaWV3SW5mbyA9IFtdO1xuICAgICAgICBmb3IodmFyIGkgaW4gY2hhbmdlTW9kZWxzKXtcbiAgICAgICAgICAgIHZhciBtb2RlbCA9IGNoYW5nZU1vZGVsc1tpXTtcbiAgICAgICAgICAgIHZhciB2aWV3SW5mbyA9IHRoaXMuZmluZFZpZXdCeU1vZGVsKG1vZGVsKTtcbiAgICAgICAgICAgIHZhciB2aWV3ID0gbnVsbDtcbiAgICAgICAgICAgIC8vIOWmguaenOWOn+adpeeahGNlbGzkuI3lrZjlnKjvvIzliJnmlrDlu7pcbiAgICAgICAgICAgIGlmKCF2aWV3SW5mbyl7XG4gICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBtb2RlbC50eXBlO1xuICAgICAgICAgICAgICAgIHZhciBhbmlWaWV3ID0gY2MuaW5zdGFudGlhdGUodGhpcy5hbmlQcmVbdHlwZV0pO1xuICAgICAgICAgICAgICAgIGFuaVZpZXcucGFyZW50ID0gdGhpcy5ub2RlO1xuICAgICAgICAgICAgICAgIHZhciBjZWxsVmlld1NjcmlwdCA9IGFuaVZpZXcuZ2V0Q29tcG9uZW50KFwiQ2VsbFZpZXdcIik7XG4gICAgICAgICAgICAgICAgY2VsbFZpZXdTY3JpcHQuaW5pdFdpdGhNb2RlbChtb2RlbCk7XG4gICAgICAgICAgICAgICAgdmlldyA9IGFuaVZpZXc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDlpoLmnpzlt7Lnu4/lrZjlnKhcbiAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgdmlldyA9IHZpZXdJbmZvLnZpZXc7XG4gICAgICAgICAgICAgICAgdGhpcy5jZWxsVmlld3Nbdmlld0luZm8ueV1bdmlld0luZm8ueF0gPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNlbGxTY3JpcHQgPSB2aWV3LmdldENvbXBvbmVudChcIkNlbGxWaWV3XCIpO1xuICAgICAgICAgICAgY2VsbFNjcmlwdC51cGRhdGVWaWV3KCk7Ly8g5omn6KGM56e75Yqo5Yqo5L2cXG4gICAgICAgICAgICBpZiAoIW1vZGVsLmlzRGVhdGgpIHtcbiAgICAgICAgICAgICAgICBuZXdDZWxsVmlld0luZm8ucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG1vZGVsOiBtb2RlbCxcbiAgICAgICAgICAgICAgICAgICAgdmlldzogdmlld1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBcbiAgICAgICAgfVxuICAgICAgICAvLyDph43mlrDmoIforrB0aGlzLmNlbGx2aWV3c+eahOS/oeaBr1xuICAgICAgICBuZXdDZWxsVmlld0luZm8uZm9yRWFjaChmdW5jdGlvbihlbGUpe1xuICAgICAgICAgICAgbGV0IG1vZGVsID0gZWxlLm1vZGVsO1xuICAgICAgICAgICAgdGhpcy5jZWxsVmlld3NbbW9kZWwueV1bbW9kZWwueF0gPSBlbGUudmlldztcbiAgICAgICAgfSx0aGlzKTtcbiAgICB9LFxuICAgIC8vIOaYvuekuumAieS4reeahOagvOWtkOiDjOaZr1xuICAgIHVwZGF0ZVNlbGVjdDogZnVuY3Rpb24ocG9zKXtcbiAgICAgICAgIGZvcih2YXIgaSA9IDE7aSA8PTkgO2krKyl7XG4gICAgICAgICAgICBmb3IodmFyIGogPSAxIDtqIDw9OSA7aiArKyl7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5jZWxsVmlld3NbaV1bal0pe1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2VsbFNjcmlwdCA9IHRoaXMuY2VsbFZpZXdzW2ldW2pdLmdldENvbXBvbmVudChcIkNlbGxWaWV3XCIpO1xuICAgICAgICAgICAgICAgICAgICBpZihwb3MueCA9PSBqICYmIHBvcy55ID09aSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsU2NyaXB0LnNldFNlbGVjdCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbFNjcmlwdC5zZXRTZWxlY3QoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDmoLnmja5jZWxs55qEbW9kZWzov5Tlm57lr7nlupTnmoR2aWV3XG4gICAgICovXG4gICAgZmluZFZpZXdCeU1vZGVsOiBmdW5jdGlvbihtb2RlbCl7XG4gICAgICAgIGZvcih2YXIgaSA9IDE7aSA8PTkgO2krKyl7XG4gICAgICAgICAgICBmb3IodmFyIGogPSAxIDtqIDw9OSA7aiArKyl7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5jZWxsVmlld3NbaV1bal0gJiYgdGhpcy5jZWxsVmlld3NbaV1bal0uZ2V0Q29tcG9uZW50KFwiQ2VsbFZpZXdcIikubW9kZWwgPT0gbW9kZWwpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge3ZpZXc6dGhpcy5jZWxsVmlld3NbaV1bal0seDpqLCB5Oml9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuICAgIGdldFBsYXlBbmlUaW1lOiBmdW5jdGlvbihjaGFuZ2VNb2RlbHMpe1xuICAgICAgICBpZighY2hhbmdlTW9kZWxzKXtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIHZhciBtYXhUaW1lID0gMDtcbiAgICAgICAgY2hhbmdlTW9kZWxzLmZvckVhY2goZnVuY3Rpb24oZWxlKXtcbiAgICAgICAgICAgIGVsZS5jbWQuZm9yRWFjaChmdW5jdGlvbihjbWQpe1xuICAgICAgICAgICAgICAgIGlmKG1heFRpbWUgPCBjbWQucGxheVRpbWUgKyBjbWQua2VlcFRpbWUpe1xuICAgICAgICAgICAgICAgICAgICBtYXhUaW1lID0gY21kLnBsYXlUaW1lICsgY21kLmtlZXBUaW1lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sdGhpcylcbiAgICAgICAgfSx0aGlzKTtcbiAgICAgICAgcmV0dXJuIG1heFRpbWU7XG4gICAgfSxcbiAgICAvLyDojrflvpfniIbngrjmrKHmlbDvvIwg5ZCM5LiA5Liq5pe26Ze0566X5LiA5LiqXG4gICAgZ2V0U3RlcDogZnVuY3Rpb24oZWZmZWN0c1F1ZXVlKXtcbiAgICAgICAgaWYoIWVmZmVjdHNRdWV1ZSl7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZWZmZWN0c1F1ZXVlLnJlZHVjZShmdW5jdGlvbihtYXhWYWx1ZSwgZWZmZmVjdENtZCl7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5tYXgobWF4VmFsdWUsIGVmZmZlY3RDbWQuc3RlcCB8fCAwKTtcbiAgICAgICAgfSwgMCk7XG4gICAgfSxcbiAgICAvL+S4gOauteaXtumXtOWGheemgeatouaTjeS9nFxuICAgIGRpc2FibGVUb3VjaDogZnVuY3Rpb24odGltZSwgc3RlcCl7XG4gICAgICAgIGlmKHRpbWUgPD0gMCl7XG4gICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNJblBsYXlBbmkgPSB0cnVlO1xuICAgICAgICB0aGlzLm5vZGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLmRlbGF5VGltZSh0aW1lKSxjYy5jYWxsRnVuYyhmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5pc0luUGxheUFuaSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5hdWRpb1V0aWxzLnBsYXlDb250aW51b3VzTWF0Y2goc3RlcCk7XG4gICAgICAgIH0sIHRoaXMpKSk7XG4gICAgfSxcbiAgICAvLyDmraPluLjlh7vkuK3moLzlrZDlkI7nmoTmk43kvZxcbiAgICBzZWxlY3RDZWxsOiBmdW5jdGlvbihjZWxsUG9zKXtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuY29udHJvbGxlci5zZWxlY3RDZWxsKGNlbGxQb3MpOyAvLyDnm7TmjqXlhYjkuKLnu5ltb2RlbOWkhOeQhuaVsOaNrumAu+i+kVxuICAgICAgICB2YXIgY2hhbmdlTW9kZWxzID0gcmVzdWx0WzBdOyAvLyDmnInmlLnlj5jnmoRjZWxs77yM5YyF5ZCr5paw55Sf5oiQ55qEY2VsbOWSjOeUn+aIkOmprOS4iuaRp+avgeeahOagvOWtkFxuICAgICAgICB2YXIgZWZmZWN0c1F1ZXVlID0gcmVzdWx0WzFdOyAvL+WQhOenjeeJueaViFxuICAgICAgICB0aGlzLnBsYXlFZmZlY3QoZWZmZWN0c1F1ZXVlKTtcbiAgICAgICAgdGhpcy5kaXNhYmxlVG91Y2godGhpcy5nZXRQbGF5QW5pVGltZShjaGFuZ2VNb2RlbHMpLCB0aGlzLmdldFN0ZXAoZWZmZWN0c1F1ZXVlKSk7XG4gICAgICAgIHRoaXMudXBkYXRlVmlldyhjaGFuZ2VNb2RlbHMpO1xuICAgICAgICB0aGlzLmNvbnRyb2xsZXIuY2xlYW5DbWQoKTsgXG4gICAgICAgIGlmKGNoYW5nZU1vZGVscy5sZW5ndGggPj0gMil7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdChjYy52MigtMSwtMSkpO1xuICAgICAgICAgICAgdGhpcy5hdWRpb1V0aWxzLnBsYXlTd2FwKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZXtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0KGNlbGxQb3MpO1xuICAgICAgICAgICAgdGhpcy5hdWRpb1V0aWxzLnBsYXlDbGljaygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGFuZ2VNb2RlbHM7XG4gICAgfSxcbiAgICBwbGF5RWZmZWN0OiBmdW5jdGlvbihlZmZlY3RzUXVldWUpe1xuICAgICAgICB0aGlzLmVmZmVjdExheWVyLmdldENvbXBvbmVudChcIkVmZmVjdExheWVyXCIpLnBsYXlFZmZlY3RzKGVmZmVjdHNRdWV1ZSk7XG4gICAgfVxuXG5cblxuXG4gICAgLy8gY2FsbGVkIGV2ZXJ5IGZyYW1lLCB1bmNvbW1lbnQgdGhpcyBmdW5jdGlvbiB0byBhY3RpdmF0ZSB1cGRhdGUgY2FsbGJhY2tcbiAgICAvLyB1cGRhdGU6IGZ1bmN0aW9uIChkdCkge1xuXG4gICAgLy8gfSxcbn0pO1xuIl19